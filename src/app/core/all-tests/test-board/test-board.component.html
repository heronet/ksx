<div class="container">
    <button routerLink="/login" mat-raised-button color="warn" *ngIf="!isAuthenticated">Login to participate</button>
    <div class="board" *ngIf="exam && !isLoading">
        <div class="header">
            <p class="title" mat-card-title>{{exam.title}}</p>
            <p mat-card-subtitle>Total Marks: {{exam.totalMarks}}</p>
            <p mat-card-subtitle>Time: {{exam.duration / 60}} minutes</p>
            <p mat-card-subtitle *ngIf="examRunning">Time Remaining: {{timeString}} minutes</p>
            <p mat-card-subtitle>Created By: {{exam.creator}} </p>
        </div>
        <button *ngIf="!examRunning && isAuthenticated && !examSubmitted" mat-raised-button color="primary" style="margin-top: 5px; width: 100%;" (click)="onStart()">Click to Start</button>
        <p class="marks" *ngIf="!examRunning && isAuthenticated && !examSubmitted && exam.participated" style="text-align: center;">You have already completed this exam with marks</p>
        <p class="marks" *ngIf="!examRunning && isAuthenticated && !examSubmitted && exam.participated" style="font-size: 25px;" [style]="exam.marksObtained > 0 ? 'color: limegreen':'color: brown'"> {{exam.marksObtained}}</p>
        <div class="questions" *ngIf="isAuthenticated && examRunning">
            <div class="question" *ngFor="let question of exam.questions; let i = index;">
                <p [mathjax]="[question.title]">{{i + 1}}. \( {{ '{}' }} \)</p>
                <div class="options">
                    <div 
                      class="option" 
                      *ngFor="let option of question.options;"
                      (click)="itemSelected(option.text, i)"
                      [ngClass]="question.providedAnswer.text === option.text ? 'selected': ''">
                      <p *ngIf="option.hasMath" [mathjax]="[option.text]">\( {{ '{}' }} \)</p>
                      <p *ngIf="!option.hasMath">{{option.text}}</p>
                    </div>
                </div>
            </div>
        </div>
        <p class="marks" *ngIf="!examRunning && isAuthenticated &&  newSubmission">Your Score is: {{exam.marksObtained}}</p>
        <div class="questions" *ngIf="!examRunning && isAuthenticated &&  newSubmission">
            <div class="question" *ngFor="let question of exam.questions; let i = index;">
                <p [mathjax]="[question.title]">{{i + 1}}. \( {{ '{}' }} \)</p>
                <div class="options">
                    <div 
                      class="option" *ngFor="let option of question.options;"
                      [ngClass]="[(question.correctAnswer.text === option.text) ? 'opt-correct': '', question.providedAnswer.text === option.text ? 'incorrect': '']">
                      <p *ngIf="option.hasMath" [mathjax]="[option.text]">\( {{ '{}' }} \)</p>
                      <p *ngIf="!option.hasMath">{{option.text}}</p>
                    </div>
                </div>
                <p style="margin-top: 0; margin-bottom: 20px;">Score: {{(question.providedAnswer.text === question.correctAnswer.text) ? (question.marks + '/' + question.marks): ('0/' + question.marks)}}</p>
            </div>
        </div>
    </div>
    <button *ngIf="!isLoading && examRunning" mat-raised-button color="primary" style="margin-top: 5px;" (click)="onSubmit()">Submit</button>
    <mat-spinner *ngIf="isLoading" [diameter]="50" style="margin: 30vw auto;"></mat-spinner>
</div>